      uses: actions/setup-node@v1
      with:
        node-version: 12.13.1
    - uses: actions/setup-java@v1
      with:
        java-version: '11.x'
    - name: Get yarn cache
      id: yarn-cache
      run: echo "::set-output name=dir::$(yarn cache dir)"
    - uses: actions/cache@v1
      with:
        path: ${{ steps.yarn-cache.outputs.dir }}
        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
        restore-keys: |
          ${{ runner.os }}-yarn-
    - uses: actions/cache@v1
      with:
        path: ~/.gradle/caches
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
    - name: Install node.js packages
      run: yarn install
    - name: Run backend test
      run: |
        chmod +x gradlew
        ./gradlew clean test integrationTest -x webpack
    - name: Run frontend test
      run: yarn run test
    - name: Analyze code with SonarQube
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      run: |
        if [ -n $SONAR_TOKEN ]; then
            ./gradlew sonarqube --no-daemon -Dsonar.host.url=https://sonarcloud.io
        else
            echo No SONAR_TOKEN, skipping...
        fi
    - name: Package application
      run: ./gradlew bootJar -Pprod -x test -x integrationTest
